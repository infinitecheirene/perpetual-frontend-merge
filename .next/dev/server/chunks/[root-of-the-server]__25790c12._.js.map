{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raiza/OneDrive/Documents/Github/perpetual_merged/perpetual_frontend/app/api/export-pdf/route.ts"],"sourcesContent":["// File: app/api/export-pdf/route.ts\r\n\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000/api\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        // Get authentication token from cookies\r\n        const cookieStore = await cookies()\r\n        const token = cookieStore.get(\"auth_token\")?.value\r\n\r\n        if (!token) {\r\n            console.error(\"No auth token found\")\r\n            return NextResponse.json(\r\n                { success: false, message: \"Unauthorized - no token\" },\r\n                { status: 401 }\r\n            )\r\n        }\r\n\r\n        // Get query parameters from the request\r\n        const searchParams = request.nextUrl.searchParams\r\n        const queryString = searchParams.toString()\r\n\r\n        // Construct Laravel API URL\r\n        const laravelUrl = queryString\r\n            ? `${API_URL}/export-pdf?${queryString}`\r\n            : `${API_URL}/export-pdf`\r\n\r\n        console.log(\"Fetching PDF from:\", laravelUrl)\r\n        console.log(\"Query params:\", queryString)\r\n\r\n        // Forward request to Laravel backend\r\n        const response = await fetch(laravelUrl, {\r\n            method: 'GET',\r\n            headers: {\r\n                Authorization: `Bearer ${token}`,\r\n                Accept: \"application/pdf\",\r\n            },\r\n        })\r\n\r\n        if (!response.ok) {\r\n            const text = await response.text()\r\n            console.error(\"Laravel PDF generation error:\", {\r\n                status: response.status,\r\n                statusText: response.statusText,\r\n                body: text\r\n            })\r\n\r\n            return NextResponse.json(\r\n                {\r\n                    success: false,\r\n                    message: \"Failed to generate PDF from backend\",\r\n                    error: text\r\n                },\r\n                { status: response.status }\r\n            )\r\n        }\r\n\r\n        // Get PDF buffer\r\n        const buffer = await response.arrayBuffer()\r\n\r\n        // Generate filename with current date\r\n        const filename = `users-report-${new Date().toISOString().split('T')[0]}.pdf`\r\n\r\n        // Return PDF response\r\n        return new NextResponse(buffer, {\r\n            status: 200,\r\n            headers: {\r\n                \"Content-Type\": \"application/pdf\",\r\n                \"Content-Disposition\": `attachment; filename=\"${filename}\"`,\r\n                \"Content-Length\": buffer.byteLength.toString(),\r\n            },\r\n        })\r\n\r\n    } catch (error) {\r\n        console.error(\"PDF API route error:\", error)\r\n        return NextResponse.json(\r\n            {\r\n                success: false,\r\n                message: \"Internal server error\",\r\n                error: error instanceof Error ? error.message : \"Unknown error\"\r\n            },\r\n            { status: 500 }\r\n        )\r\n    }\r\n}"],"names":[],"mappings":";;;;AAAA,oCAAoC;AAEpC;AACA;;;AAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAE5C,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,wCAAwC;QACxC,MAAM,cAAc,MAAM,IAAA,sLAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;QAE7C,IAAI,CAAC,OAAO;YACR,QAAQ,KAAK,CAAC;YACd,OAAO,0LAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;gBAAO,SAAS;YAA0B,GACrD;gBAAE,QAAQ;YAAI;QAEtB;QAEA,wCAAwC;QACxC,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,cAAc,aAAa,QAAQ;QAEzC,4BAA4B;QAC5B,MAAM,aAAa,cACb,GAAG,QAAQ,YAAY,EAAE,aAAa,GACtC,GAAG,QAAQ,WAAW,CAAC;QAE7B,QAAQ,GAAG,CAAC,sBAAsB;QAClC,QAAQ,GAAG,CAAC,iBAAiB;QAE7B,qCAAqC;QACrC,MAAM,WAAW,MAAM,MAAM,YAAY;YACrC,QAAQ;YACR,SAAS;gBACL,eAAe,CAAC,OAAO,EAAE,OAAO;gBAChC,QAAQ;YACZ;QACJ;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YACd,MAAM,OAAO,MAAM,SAAS,IAAI;YAChC,QAAQ,KAAK,CAAC,iCAAiC;gBAC3C,QAAQ,SAAS,MAAM;gBACvB,YAAY,SAAS,UAAU;gBAC/B,MAAM;YACV;YAEA,OAAO,0LAAY,CAAC,IAAI,CACpB;gBACI,SAAS;gBACT,SAAS;gBACT,OAAO;YACX,GACA;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAElC;QAEA,iBAAiB;QACjB,MAAM,SAAS,MAAM,SAAS,WAAW;QAEzC,sCAAsC;QACtC,MAAM,WAAW,CAAC,aAAa,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC;QAE7E,sBAAsB;QACtB,OAAO,IAAI,0LAAY,CAAC,QAAQ;YAC5B,QAAQ;YACR,SAAS;gBACL,gBAAgB;gBAChB,uBAAuB,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC;gBAC3D,kBAAkB,OAAO,UAAU,CAAC,QAAQ;YAChD;QACJ;IAEJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,0LAAY,CAAC,IAAI,CACpB;YACI,SAAS;YACT,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}