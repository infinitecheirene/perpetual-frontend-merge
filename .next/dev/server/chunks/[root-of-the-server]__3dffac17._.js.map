{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raiza/OneDrive/Documents/Github/perpetual_merged/perpetual_frontend/app/api/auth/me/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000/api\"\r\n\r\nexport async function GET() {\r\n  try {\r\n    const cookieStore = await cookies()\r\n    const token = cookieStore.get('auth_token')?.value\r\n\r\n    console.log('API Route /api/auth/me - Token exists:', !!token)\r\n\r\n    if (!token) {\r\n      return NextResponse.json(\r\n        { success: false, message: \"Not authenticated\" },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    // Use token to fetch user data from Laravel\r\n    const response = await fetch(`${API_URL}/auth/me`, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        Accept: \"application/json\",\r\n      },\r\n    })\r\n\r\n    console.log('API Route - Laravel response status:', response.status)\r\n\r\n    if (!response.ok) {\r\n      console.log('API Route - Laravel response not OK')\r\n      return NextResponse.json(\r\n        { success: false, message: \"Invalid token\" },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    const data = await response.json()\r\n    console.log('API Route - Laravel response data:', data)\r\n\r\n    // Laravel returns: { success: true, data: { user: {...} } }\r\n    // So we need to extract data.data.user\r\n    const user = data?.data?.user || null\r\n\r\n    console.log('API Route - Extracted user:', user)\r\n\r\n    if (!user) {\r\n      return NextResponse.json(\r\n        { success: false, message: \"User data not found in response\" },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    // Return in the format the frontend expects: { success: true, user: {...} }\r\n    return NextResponse.json({\r\n      success: true,\r\n      user: user\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('API Route - Error:', error)\r\n    return NextResponse.json(\r\n      { success: false, message: \"Authentication failed\" },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAE5C,eAAe;IACpB,IAAI;QACF,MAAM,cAAc,MAAM,IAAA,sLAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;QAE7C,QAAQ,GAAG,CAAC,0CAA0C,CAAC,CAAC;QAExD,IAAI,CAAC,OAAO;YACV,OAAO,0LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAoB,GAC/C;gBAAE,QAAQ;YAAI;QAElB;QAEA,4CAA4C;QAC5C,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,QAAQ,CAAC,EAAE;YACjD,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,OAAO;gBAChC,QAAQ;YACV;QACF;QAEA,QAAQ,GAAG,CAAC,wCAAwC,SAAS,MAAM;QAEnE,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,GAAG,CAAC;YACZ,OAAO,0LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAgB,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC,sCAAsC;QAElD,4DAA4D;QAC5D,uCAAuC;QACvC,MAAM,OAAO,MAAM,MAAM,QAAQ;QAEjC,QAAQ,GAAG,CAAC,+BAA+B;QAE3C,IAAI,CAAC,MAAM;YACT,OAAO,0LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAkC,GAC7D;gBAAE,QAAQ;YAAI;QAElB;QAEA,4EAA4E;QAC5E,OAAO,0LAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;QACR;IAEF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,0LAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;QAAwB,GACnD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}