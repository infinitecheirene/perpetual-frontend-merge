{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raiza/OneDrive/Documents/Github/perpetual_merged/perpetual_frontend/app/api/business-partners/route.ts"],"sourcesContent":["// app/api/business-partners/route.ts\r\nimport { NextRequest, NextResponse } from \"next/server\"\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:8000/api\"\r\nconst IMAGE_BASE_URL = process.env.NEXT_PUBLIC_IMAGE_URL || \"http://localhost:8000\"\r\n\r\n// Helper function to transform photo URLs\r\nfunction transformPhotoUrl(photoPath: string | null | undefined): string | null {\r\n  if (!photoPath) return null\r\n  \r\n  // If already a full URL, return as is\r\n  if (photoPath.startsWith('http://') || photoPath.startsWith('https://')) {\r\n    return photoPath\r\n  }\r\n  \r\n  // Construct full URL from relative path\r\n  const cleanPath = photoPath.startsWith('/') ? photoPath : `/${photoPath}`\r\n  return `${IMAGE_BASE_URL}${cleanPath}`\r\n}\r\n\r\n// Public endpoint - Get all approved business partners\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const url = new URL(req.url)\r\n    const queryParams = url.searchParams.toString()\r\n\r\n    console.log(\"Fetching public business partners from:\", `${API_URL}/business-partners${queryParams ? '?' + queryParams : ''}`)\r\n\r\n    const res = await fetch(`${API_URL}/business-partners${queryParams ? '?' + queryParams : ''}`, {\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        \"X-Requested-With\": \"XMLHttpRequest\",\r\n      },\r\n      cache: 'no-store', // Disable caching to always get fresh data\r\n    })\r\n\r\n    const contentType = res.headers.get(\"content-type\")\r\n    let data\r\n\r\n    if (contentType?.includes(\"application/json\")) {\r\n      data = await res.json()\r\n      console.log(\"Laravel response:\", data)\r\n      \r\n      // Transform photo URLs in the response\r\n      if (data.success && data.data) {\r\n        if (Array.isArray(data.data)) {\r\n          // Handle array of business partners\r\n          data.data = data.data.map((partner: any) => ({\r\n            ...partner,\r\n            photo: transformPhotoUrl(partner.photo)\r\n          }))\r\n        } else if (data.data.data && Array.isArray(data.data.data)) {\r\n          // Handle paginated response\r\n          data.data.data = data.data.data.map((partner: any) => ({\r\n            ...partner,\r\n            photo: transformPhotoUrl(partner.photo)\r\n          }))\r\n        }\r\n      }\r\n      \r\n      console.log(\"Transformed response with full image URLs\")\r\n    } else {\r\n      const text = await res.text()\r\n      console.error(\"Non-JSON response from Laravel:\", text)\r\n      return NextResponse.json({ \r\n        success: false, \r\n        message: \"Invalid response from server\",\r\n        debug: text.substring(0, 500)\r\n      }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json(data, { status: res.status })\r\n  } catch (err) {\r\n    console.error(\"Server error:\", err)\r\n    return NextResponse.json({ \r\n      success: false, \r\n      message: \"Server error\",\r\n      error: err instanceof Error ? err.message : \"Unknown error\"\r\n    }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA,qCAAqC;AACrC;;AAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AACnD,MAAM,iBAAiB,QAAQ,GAAG,CAAC,qBAAqB,IAAI;AAE5D,0CAA0C;AAC1C,SAAS,kBAAkB,SAAoC;IAC7D,IAAI,CAAC,WAAW,OAAO;IAEvB,sCAAsC;IACtC,IAAI,UAAU,UAAU,CAAC,cAAc,UAAU,UAAU,CAAC,aAAa;QACvE,OAAO;IACT;IAEA,wCAAwC;IACxC,MAAM,YAAY,UAAU,UAAU,CAAC,OAAO,YAAY,CAAC,CAAC,EAAE,WAAW;IACzE,OAAO,GAAG,iBAAiB,WAAW;AACxC;AAGO,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,MAAM,IAAI,IAAI,IAAI,GAAG;QAC3B,MAAM,cAAc,IAAI,YAAY,CAAC,QAAQ;QAE7C,QAAQ,GAAG,CAAC,2CAA2C,GAAG,QAAQ,kBAAkB,EAAE,cAAc,MAAM,cAAc,IAAI;QAE5H,MAAM,MAAM,MAAM,MAAM,GAAG,QAAQ,kBAAkB,EAAE,cAAc,MAAM,cAAc,IAAI,EAAE;YAC7F,SAAS;gBACP,QAAQ;gBACR,oBAAoB;YACtB;YACA,OAAO;QACT;QAEA,MAAM,cAAc,IAAI,OAAO,CAAC,GAAG,CAAC;QACpC,IAAI;QAEJ,IAAI,aAAa,SAAS,qBAAqB;YAC7C,OAAO,MAAM,IAAI,IAAI;YACrB,QAAQ,GAAG,CAAC,qBAAqB;YAEjC,uCAAuC;YACvC,IAAI,KAAK,OAAO,IAAI,KAAK,IAAI,EAAE;gBAC7B,IAAI,MAAM,OAAO,CAAC,KAAK,IAAI,GAAG;oBAC5B,oCAAoC;oBACpC,KAAK,IAAI,GAAG,KAAK,IAAI,CAAC,GAAG,CAAC,CAAC,UAAiB,CAAC;4BAC3C,GAAG,OAAO;4BACV,OAAO,kBAAkB,QAAQ,KAAK;wBACxC,CAAC;gBACH,OAAO,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,MAAM,OAAO,CAAC,KAAK,IAAI,CAAC,IAAI,GAAG;oBAC1D,4BAA4B;oBAC5B,KAAK,IAAI,CAAC,IAAI,GAAG,KAAK,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,UAAiB,CAAC;4BACrD,GAAG,OAAO;4BACV,OAAO,kBAAkB,QAAQ,KAAK;wBACxC,CAAC;gBACH;YACF;YAEA,QAAQ,GAAG,CAAC;QACd,OAAO;YACL,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,QAAQ,KAAK,CAAC,mCAAmC;YACjD,OAAO,0LAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,SAAS;gBACT,OAAO,KAAK,SAAS,CAAC,GAAG;YAC3B,GAAG;gBAAE,QAAQ;YAAI;QACnB;QAEA,OAAO,0LAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ,IAAI,MAAM;QAAC;IACtD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,0LAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,OAAO,eAAe,QAAQ,IAAI,OAAO,GAAG;QAC9C,GAAG;YAAE,QAAQ;QAAI;IACnB;AACF"}}]
}