{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raiza/OneDrive/Documents/Github/perpetual_merged/perpetual_frontend/app/api/admin/legitimacy/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { cookies } from \"next/headers\"\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || process.env.API_URL || \"http://localhost:8000/api\"\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const cookieStore = await cookies()\r\n    const token = cookieStore.get(\"auth_token\")?.value\r\n    \r\n    if (!token) {\r\n      return NextResponse.json({ success: false, message: \"Unauthorized\" }, { status: 401 })\r\n    }\r\n\r\n    const url = new URL(req.url)\r\n    const queryParams = url.searchParams.toString()\r\n\r\n    const res = await fetch(`${API_URL}/admin/legitimacy?${queryParams}`, {\r\n      headers: {\r\n        Authorization: `Bearer ${token}`,\r\n        Accept: \"application/json\",\r\n        \"X-Requested-With\": \"XMLHttpRequest\",\r\n      },\r\n      credentials: \"include\",\r\n    })\r\n\r\n    const contentType = res.headers.get(\"content-type\")\r\n    \r\n    if (!contentType?.includes(\"application/json\")) {\r\n      const text = await res.text()\r\n      console.error(\"Non-JSON response:\", text)\r\n      return NextResponse.json({ success: false, message: \"Invalid response from server\" }, { status: 500 })\r\n    }\r\n\r\n    const data = await res.json()\r\n    return NextResponse.json(data, { status: res.status })\r\n  } catch (err) {\r\n    console.error(\"Admin legitimacy GET error:\", err)\r\n    return NextResponse.json(\r\n      { \r\n        success: false, \r\n        message: \"Server error\",\r\n        error: err instanceof Error ? err.message : \"Unknown error\"\r\n      }, \r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const cookieStore = await cookies()\r\n    const authToken = cookieStore.get(\"auth_token\")\r\n\r\n    if (!authToken) {\r\n      return NextResponse.json(\r\n        { success: false, message: \"Authentication required\" }, \r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    const formData = await request.formData()\r\n\r\n    const response = await fetch(`${API_URL}/admin/legitimacy`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Accept: \"application/json\",\r\n        Authorization: `Bearer ${authToken.value}`,\r\n        \"X-Requested-With\": \"XMLHttpRequest\",\r\n      },\r\n      credentials: \"include\",\r\n      body: formData,\r\n    })\r\n\r\n    const contentType = response.headers.get(\"content-type\")\r\n    let data\r\n\r\n    if (contentType?.includes(\"application/json\")) {\r\n      data = await response.json()\r\n    } else {\r\n      const text = await response.text()\r\n      console.error(\"Non-JSON response from Laravel:\", text)\r\n      return NextResponse.json(\r\n        { success: false, message: \"Invalid response from server\" }, \r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    if (!response.ok) {\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          message: data.message || \"Failed to create legitimacy request\",\r\n          errors: data.errors,\r\n        },\r\n        { status: response.status }\r\n      )\r\n    }\r\n\r\n    return NextResponse.json(data, { status: 201 })\r\n  } catch (error) {\r\n    console.error(\"Error creating legitimacy request:\", error)\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: \"Internal server error\",\r\n        error: error instanceof Error ? error.message : \"Unknown error\",\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":"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"}}]
}