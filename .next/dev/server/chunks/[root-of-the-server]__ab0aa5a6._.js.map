{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raiza/OneDrive/Documents/Github/perpetual_merged/perpetual_frontend/app/api/trigger-news-email/route.ts"],"sourcesContent":["// app/api/trigger-news-email/route.ts\r\nimport { NextRequest, NextResponse } from 'next/server';\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { news } = body;\r\n\r\n    if (!news) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'News data is required' },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Prepare email data\r\n    const emailData = {\r\n      title: news.title,\r\n      content: news.content,\r\n      category: news.category,\r\n      published_at: news.published_at \r\n        ? new Date(news.published_at).toLocaleDateString('en-US', {\r\n            year: 'numeric',\r\n            month: 'long',\r\n            day: 'numeric',\r\n          })\r\n        : new Date().toLocaleDateString('en-US', {\r\n            year: 'numeric',\r\n            month: 'long',\r\n            day: 'numeric',\r\n          }),\r\n      imageUrl: news.image \r\n        ? `${process.env.NEXT_PUBLIC_IMAGE_URL}/${news.image}`\r\n        : null,\r\n      readMoreUrl: `${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/news/${news.id}`,\r\n    };\r\n\r\n    // Call the bulk email API route\r\n    const response = await fetch(`${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3000'}/api/send-bulk-email`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        type: 'news',\r\n        data: emailData,\r\n      }),\r\n    });\r\n\r\n    const result = await response.json();\r\n\r\n    if (!response.ok) {\r\n      throw new Error(result.message || 'Failed to send emails');\r\n    }\r\n\r\n    console.log('News emails triggered:', result);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: 'News emails sent successfully',\r\n      results: result.results,\r\n    });\r\n\r\n  } catch (error: any) {\r\n    console.error('Error triggering news emails:', error);\r\n    return NextResponse.json(\r\n      { success: false, message: 'Failed to send news emails', error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA,sCAAsC;AACtC;;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,GAAG;QAEjB,IAAI,CAAC,MAAM;YACT,OAAO,0LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAwB,GACnD;gBAAE,QAAQ;YAAI;QAElB;QAEA,qBAAqB;QACrB,MAAM,YAAY;YAChB,OAAO,KAAK,KAAK;YACjB,SAAS,KAAK,OAAO;YACrB,UAAU,KAAK,QAAQ;YACvB,cAAc,KAAK,YAAY,GAC3B,IAAI,KAAK,KAAK,YAAY,EAAE,kBAAkB,CAAC,SAAS;gBACtD,MAAM;gBACN,OAAO;gBACP,KAAK;YACP,KACA,IAAI,OAAO,kBAAkB,CAAC,SAAS;gBACrC,MAAM;gBACN,OAAO;gBACP,KAAK;YACP;YACJ,UAAU,KAAK,KAAK,GAChB,GAAG,QAAQ,GAAG,CAAC,qBAAqB,CAAC,CAAC,EAAE,KAAK,KAAK,EAAE,GACpD;YACJ,aAAa,GAAG,QAAQ,GAAG,CAAC,mBAAmB,IAAI,wBAAwB,MAAM,EAAE,KAAK,EAAE,EAAE;QAC9F;QAEA,gCAAgC;QAChC,MAAM,WAAW,MAAM,MAAM,GAAG,QAAQ,GAAG,CAAC,mBAAmB,IAAI,wBAAwB,oBAAoB,CAAC,EAAE;YAChH,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;YACA,MAAM,KAAK,SAAS,CAAC;gBACnB,MAAM;gBACN,MAAM;YACR;QACF;QAEA,MAAM,SAAS,MAAM,SAAS,IAAI;QAElC,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,IAAI,MAAM,OAAO,OAAO,IAAI;QACpC;QAEA,QAAQ,GAAG,CAAC,0BAA0B;QAEtC,OAAO,0LAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;YACT,SAAS,OAAO,OAAO;QACzB;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,0LAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,SAAS;YAA8B,OAAO,MAAM,OAAO;QAAC,GAC9E;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}