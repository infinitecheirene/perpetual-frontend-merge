{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/raiza/OneDrive/Documents/Github/perpetual_merged/perpetual_frontend/app/api/users/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { cookies } from 'next/headers'\r\n\r\nconst LARAVEL_API_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000/api'\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    // Get token from HTTP-only cookie - cookies() is synchronous in Next.js 15+\r\n    const cookieStore = await cookies()\r\n    const token = cookieStore.get('auth_token')?.value\r\n\r\n    if (!token) {\r\n      return NextResponse.json(\r\n        { success: false, message: 'Not authenticated. Please log in again.' },\r\n        { status: 401 }\r\n      )\r\n    }\r\n\r\n    // Get query parameters\r\n    const searchParams = request.nextUrl.searchParams\r\n    const status = searchParams.get('status')\r\n    const search = searchParams.get('search')\r\n    const page = searchParams.get('page')\r\n    const perPage = searchParams.get('per_page')\r\n\r\n    // Build query string\r\n    const queryParams = new URLSearchParams()\r\n    if (status && status !== 'all') queryParams.append('status', status)\r\n    if (search) queryParams.append('search', search)\r\n    if (page) queryParams.append('page', page)\r\n    if (perPage) queryParams.append('per_page', perPage)\r\n\r\n    const queryString = queryParams.toString()\r\n    const url = `${LARAVEL_API_URL}/users${queryString ? `?${queryString}` : ''}`\r\n\r\n    console.log('Fetching users:', {\r\n      url,\r\n      hasAuth: !!token,\r\n    })\r\n\r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Accept': 'application/json',\r\n        'Authorization': `Bearer ${token}`,\r\n        'X-Requested-With': 'XMLHttpRequest',\r\n      },\r\n    })\r\n\r\n    // Get raw text first to check what we're receiving\r\n    const responseText = await response.text()\r\n    \r\n    console.log('Laravel raw response:', {\r\n      status: response.status,\r\n      contentType: response.headers.get('content-type'),\r\n      textLength: responseText.length,\r\n      textPreview: responseText.substring(0, 200)\r\n    })\r\n\r\n    // Try to parse as JSON\r\n    let data\r\n    try {\r\n      data = JSON.parse(responseText)\r\n    } catch (parseError) {\r\n      console.error('JSON parse error:', parseError)\r\n      console.error('Raw response (first 1000 chars):', responseText.substring(0, 1000))\r\n      \r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          message: 'Invalid JSON response from server. Please check Laravel logs for errors.',\r\n          debug: {\r\n            status: response.status,\r\n            contentType: response.headers.get('content-type'),\r\n            preview: responseText.substring(0, 500)\r\n          }\r\n        },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    console.log('Laravel response:', {\r\n      status: response.status,\r\n      success: data.success,\r\n    })\r\n\r\n    return NextResponse.json(data, { status: response.status })\r\n\r\n  } catch (error) {\r\n    console.error('API route error:', error)\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: error instanceof Error ? error.message : 'Internal server error',\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,kBAAkB,QAAQ,GAAG,CAAC,mBAAmB,IAAI;AAEpD,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,4EAA4E;QAC5E,MAAM,cAAc,MAAM,IAAA,sLAAO;QACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,eAAe;QAE7C,IAAI,CAAC,OAAO;YACV,OAAO,0LAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA0C,GACrE;gBAAE,QAAQ;YAAI;QAElB;QAEA,uBAAuB;QACvB,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,OAAO,aAAa,GAAG,CAAC;QAC9B,MAAM,UAAU,aAAa,GAAG,CAAC;QAEjC,qBAAqB;QACrB,MAAM,cAAc,IAAI;QACxB,IAAI,UAAU,WAAW,OAAO,YAAY,MAAM,CAAC,UAAU;QAC7D,IAAI,QAAQ,YAAY,MAAM,CAAC,UAAU;QACzC,IAAI,MAAM,YAAY,MAAM,CAAC,QAAQ;QACrC,IAAI,SAAS,YAAY,MAAM,CAAC,YAAY;QAE5C,MAAM,cAAc,YAAY,QAAQ;QACxC,MAAM,MAAM,GAAG,gBAAgB,MAAM,EAAE,cAAc,CAAC,CAAC,EAAE,aAAa,GAAG,IAAI;QAE7E,QAAQ,GAAG,CAAC,mBAAmB;YAC7B;YACA,SAAS,CAAC,CAAC;QACb;QAEA,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,QAAQ;YACR,SAAS;gBACP,UAAU;gBACV,iBAAiB,CAAC,OAAO,EAAE,OAAO;gBAClC,oBAAoB;YACtB;QACF;QAEA,mDAAmD;QACnD,MAAM,eAAe,MAAM,SAAS,IAAI;QAExC,QAAQ,GAAG,CAAC,yBAAyB;YACnC,QAAQ,SAAS,MAAM;YACvB,aAAa,SAAS,OAAO,CAAC,GAAG,CAAC;YAClC,YAAY,aAAa,MAAM;YAC/B,aAAa,aAAa,SAAS,CAAC,GAAG;QACzC;QAEA,uBAAuB;QACvB,IAAI;QACJ,IAAI;YACF,OAAO,KAAK,KAAK,CAAC;QACpB,EAAE,OAAO,YAAY;YACnB,QAAQ,KAAK,CAAC,qBAAqB;YACnC,QAAQ,KAAK,CAAC,oCAAoC,aAAa,SAAS,CAAC,GAAG;YAE5E,OAAO,0LAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,SAAS;gBACT,OAAO;oBACL,QAAQ,SAAS,MAAM;oBACvB,aAAa,SAAS,OAAO,CAAC,GAAG,CAAC;oBAClC,SAAS,aAAa,SAAS,CAAC,GAAG;gBACrC;YACF,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,qBAAqB;YAC/B,QAAQ,SAAS,MAAM;YACvB,SAAS,KAAK,OAAO;QACvB;QAEA,OAAO,0LAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ,SAAS,MAAM;QAAC;IAE3D,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,0LAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}